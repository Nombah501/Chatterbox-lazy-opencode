# AGENTS.md

Назначение
- Репозиторий содержит исходный код Python и метаданные сборки (`src/`, `pyproject.toml`).
- MVP готов: синтез ответов агентов, TTS-озвучка, экспорт результатов, управление детализацией.
- BMAD Method установлен и используется для управления спринтами.

Состояние репозитория
- Git инициализирован, ветка main отслеживается на origin/main.
- MVP реализован (13 stories, 42 SP) по Epics 1, 2, 3.
- BMAD artifacts: `_bmad-output/implementation-artifacts/` (stories, retrospective).
- CLI готов к ручному тестированию.
- Репозиторий оформлен для публичного представления: README.md, LICENSE (MIT), .editorconfig.

Следующий этап: интеграция с OpenCode
- План: `_bmad-output/planning-artifacts/opencode-integration-plan.md`
- Подход: OpenCode Plugin + событие session.idle
- Scope: Epic 4 (8 stories, 18 SP)

Политика языка
- Язык общения: русский.
- Язык документации: русский (README, инструкции, ADR, пользовательские сообщения).
- В коде идентификаторы и комментарии — по стандартам выбранного языка.
- Публичные API и сообщения об ошибках на русском, если продукт не требует иного.

Правила использования MCP
- Используйте MCP-инструменты только при необходимости и по принципу наименьших привилегий.
- Не передавайте через MCP секреты, токены, персональные данные или приватные ключи.
- Проверяйте результаты MCP-операций на корректность и воспроизводимость.
- Фиксируйте источник данных, если MCP получает внешние сведения.
- Уважайте лимиты, лицензии и условия доступа к данным.

Лучшие практики
- Делайте изменения минимальными и сфокусированными на задаче.
- Не ломайте публичные API без явного запроса пользователя.
- Добавляйте комментарии только там, где логика неочевидна.
- Проверяйте код на дублирование после копирования блоков — двойные сообщения в stderr часто указывают на дублированный код.
- Все исправления и фичи вносите через отдельные ветки и PR, не напрямую в main.
- Избегайте магических значений — выносите в константы с понятными именами.
- Предпочитайте явное поведение неявному, особенно в обработке ошибок.
- Не добавляйте зависимости без явной необходимости.
- Соблюдайте обратную совместимость в конфигурации и форматах данных.
- Не смешивайте рефакторинг с функциональными изменениями.
- Проверяйте, что новые зависимости имеют живое сообщество и хорошую поддержку.
- Соблюдайте рекомендации по размеру файлов: стремитесь держать файлы в пределах 500–600 строк.
- Пользуйтесь Git; настройте грамотную рабочую среду для публикации в GitHub.
- В исследовательских и плановых артефактах фиксируйте источники ссылками и датой.
- Не добавляйте крупные бинарные файлы (>5MB) без явного запроса.
- Следуйте полному жизненному циклу продукта по https://github.com/bmad-code-org/BMAD-METHOD.
- Любая ошибка агента должна превращаться в правило в этом файле.
- Перед перезаписью файла обязательно читать его через Read (иначе Write завершится ошибкой).
- Не трогайте нерелевантные файлы и не делайте каскадных правок без запроса.
- Обновляйте story-файлы (Tasks/Subtasks, Dev Agent Record, File List, Change Log, Status) только в разрешённых секциях.
- Проводите retrospective после каждого спринта для фиксации выводов.
- Закрывайте истории как done только после выполнения всех критериев приемки.

Практики рабочего процесса (по статье VentureBeat, 2026-01-05)
- Используйте параллельные агенты для независимых задач (тесты, рефакторинг, доки).
- Предпочитайте более надежную модель, если это снижает цену исправлений.
- Держите единый файл инструкций (этот файл) и обновляйте его при ошибках.
- Автоматизируйте рутину через команды/скрипты, если они появятся в репозитории.
- Ставьте верификацию в цикл разработки: тесты, проверки, ручная сверка UX.
- Применяйте специализированных агентов для отдельных фаз: упрощение кода, проверки, релизы.

BMAD Method (локальная установка)
- Основные артефакты и конфиги: `_bmad/`.
- Команды OpenCode: `.opencode/command/` (bmad-* сценарии).
- Агентные профили OpenCode: `.opencode/agent/`.
- Выходные артефакты BMAD по умолчанию: `_bmad-output/`.

- Артефакты в `_bmad-output/planning-artifacts/` и `_bmad-output/implementation-artifacts/` создавать через BMAD workflow.
- Используйте сценарии BMAD по назначению: dev-story, code-review, sprint-planning, retrospective.
- Сверяйтесь с актуальными шаблонами и манифестами в `_bmad/_config/`.
- Stories обновляются через bmad-master: Tasks/Subtasks, Dev Agent Record, File List, Change Log, Status.

Команды сборки, линтинга и тестов
- Проект Python; сборка и зависимости описаны в `pyproject.toml`.
- Рекомендуемая версия Python: 3.11.x (chatterbox-tts требует `numpy<1.26`).
- Установка (только по запросу пользователя): `python -m venv .venv` и `.venv/bin/pip install -e .`.
- Запуск CLI: `.venv/bin/cbx --text "..."`.
- Фреймворк тестирования не найден — тесты в планах.

Базовые команды CLI
- Синтез текста: `.venv/bin/cbx --text "ваш текст"`
- Синтез из JSON: `.venv/bin/cbx --input responses.json`
- Включить TTS: `.venv/bin/cbx --text "..." --tts`
- Экспорт в файл: `.venv/bin/cbx --text "..." --output result.md`
- Фильтрация секций: `.venv/bin/cbx --text "..." --show-summary --no-divergences --no-citations`
- Подробный режим: `.venv/bin/cbx --text "..." --verbose`


Чеклист поиска команд
- Проверьте файлы инструментов:
  - `package.json`, `pnpm-lock.yaml`, `yarn.lock`.
  - `pyproject.toml`, `poetry.lock`, `requirements.txt`.
  - `go.mod`, `go.sum`.
  - `Cargo.toml`, `Cargo.lock`.
  - `Makefile`, `justfile`, `Taskfile.yml`.
- Проверьте CI-конфиги, где указаны канонические команды:
  - `.github/workflows/*.yml`.
  - директории `ci/` или `scripts/`.
- Если CI есть, зеркальте команды из CI здесь.

Правила стиля кода (текущее состояние)
- Конфигурация форматирования и линтинга не обнаружена.
- Используйте стандартный стиль для выбранного языка.
- Предпочитайте простую и явную логику без избыточной магии.

Форматирование
- Если появляется форматтер, запускайте его только для затронутых файлов.
- Не форматируйте нерелевантные файлы.
- Держите длину строк разумной (цель 80–100 символов, если нет иных правил).

Импорты
- Группируйте: стандартная библиотека, сторонние, локальные.
- Сортируйте внутри групп, если инструменты не задают другое.
- Удаляйте неиспользуемые импорты при изменениях.

Именование
- Используйте понятные, говорящие имена.
- Типы/структуры/классы — существительные, функции — глаголы.
- Следуйте принятым для языка соглашениям по регистру.
- Избегайте однобуквенных имен, кроме очень локальных контекстов.

Типы и интерфейсы
- Указывайте явные типы на публичных границах.
- Не вводите интерфейсы без необходимости (минимум 2 реализации).
- Держите структуры данных рядом с местом использования.

Обработка ошибок
- Обрабатывайте ошибки явно, без молчаливых падений.
- Добавляйте полезный контекст в сообщения об ошибках.
- Не ловите слишком широкие исключения без повторного броска или логирования.

Логирование
- Если логирование добавлено, делайте его структурированным и единообразным.
- Не логируйте секреты и чувствительные данные.

Тестирование
- Добавляйте тесты при новом поведении или исправлении багов.
- Тесты должны быть детерминированными и быстрыми.
- Избегайте внешних сетевых зависимостей без моков.

Документация
- README и документы должны быть точными и краткими.
- Изменение поведения требует обновления документации.
- Не добавляйте документацию «на будущее», если она не используется.

Производительность
- Ясность важнее микрооптимизаций.
- Если производительность критична, добавляйте тест или бенчмарк.

Безопасность
- Никогда не коммитьте секреты; используйте переменные окружения.
- Токены Hugging Face хранить в `HF_TOKEN`/`HUGGINGFACE_HUB_TOKEN` или в локальном конфиге.
- Не включайте секреты в примеры, логи или тестовые данные.
- Валидируйте и санитайзьте внешние входные данные.
- Проверяйте права доступа и границы доверия.

Зависимости
- Минимизируйте количество зависимостей.
- Предпочитайте поддерживаемые и широко используемые библиотеки.
- Фиксируйте версии и пересматривайте зависимости при обновлениях.

Гигиена контроля версий
- Делайте маленькие, сфокусированные изменения.
- Не смешивайте unrelated правки в одном коммите.
- Не коммитьте сгенерированные аудиофайлы (`*.wav`).
- Держите сообщения коммитов информативными и последовательными.
- Пользуйтесь Git; настройте грамотную рабочую среду для публикации в GitHub.

Когда обновлять AGENTS.md
- Добавляйте новые команды и функционале по мере появления.
- Обновляйте плейсхолдеры конкретными значениями.
- Держите файл кратким и практичным для агентов.

Приложение: реализованный функционал
- Синтез ответов агентов с итогами и расхождениями
- TTS-озвучка через chatterbox (Turbo/Multilingual, voice prompt, GPU/CPU fallback)
- Управление детализацией вывода (--show-summary/--show-divergences/--show-citations/--verbose)
- Экспорт результатов в txt/md с фильтрацией секций
- Конфигурация через TOML/JSON и CLI-флаги
- Авто-отключение TTS в CI/неинтерактивном режиме
- Статусы обработки без блокировки основного вывода

Конец файла
