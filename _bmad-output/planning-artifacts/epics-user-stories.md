# User Stories по эпикам

## Эпик 1: Прозрачный синтез результатов

### Story 1.1 — Синтез итогов и расхождений
Краткое описание: формировать «Итог» и «Расхождения» из нескольких ответов агентов.
Ценность для пользователя: быстро понять лучший путь без чтения всего текста.
Критерии приемки:
- Дано несколько ответов агентов, когда запускается синтез, тогда вывод содержит секции «Итог» и «Расхождения».
- Итог по умолчанию краткий.
- Порядок секций соответствует «Итог -> Расхождения -> Цитаты» (если цитаты включены).
- Текстовый вывод не блокируется длительными операциями.
Приоритет: High

### Story 1.2 — Прозрачные цитаты-источники
Краткое описание: показывать цитаты, подтверждающие расхождения.
Ценность для пользователя: доверие к синтезу и возможность проверки.
Критерии приемки:
- Дано, что синтез выполнен, когда включен режим цитат, тогда отображаются цитаты с указанием источника.
- Если цитаты отсутствуют, секция «Цитаты» выводится с пометкой об отсутствии источников.
- Цитаты привязаны к соответствующим расхождениям.
Приоритет: High

### Story 1.3 — Управление уровнем детализации вывода
Краткое описание: переключение между кратким и подробным выводом.
Ценность для пользователя: контроль объема информации в CLI.
Критерии приемки:
- По умолчанию используется краткий режим.
- При указании флагов отображаются только выбранные секции.
- В подробном режиме сохраняется структура и порядок секций.
Приоритет: Medium

### Story 1.4 — Статусы обработки
Краткое описание: отображать статусы этапов обработки.
Ценность для пользователя: понимание прогресса и устранение неопределенности.
Критерии приемки:
- Во время синтеза показываются статусы «Сбор», «Синтез», «Формирование цитат», «Озвучка».
- Статусы не блокируют основную выдачу.
- При ошибке статус отражает сбой и дальнейшее продолжение текстового вывода.
Приоритет: Medium

## Эпик 2: Озвучка и управление TTS

### Story 2.1 — Включение и выключение TTS
Краткое описание: управление TTS через конфиг или команду.
Ценность для пользователя: выбор, нужен ли аудиослой.
Критерии приемки:
- При включении TTS итоговые ответы озвучиваются.
- При выключении TTS озвучка не запускается.
- Состояние TTS сохраняется в конфиге.
Приоритет: High

### Story 2.2 — Выбор голоса и скорости
Краткое описание: настройка голоса и темпа.
Ценность для пользователя: комфортное восприятие аудио.
Критерии приемки:
- При активном TTS озвучка использует выбранные голос и скорость.
- Настройки сохраняются локально и применяются по умолчанию.
- Некорректные значения не ломают вывод и приводят к безопасному дефолту.
Приоритет: Medium

### Story 2.3 — Озвучка итогов с fallback
Краткое описание: TTS не должен ломать текстовый поток.
Ценность для пользователя: надежность результата при сбоях.
Критерии приемки:
- При недоступном TTS-воркере текстовый вывод остается полным.
- Показывается предупреждение о сбое TTS.
- Озвучка не блокирует завершение команды синтеза.
Приоритет: High

### Story 2.4 — Авто-отключение в CI/неинтерактиве
Краткое описание: автоматическое отключение TTS в неподходящих средах.
Ценность для пользователя: отсутствие шума в автоматизации.
Критерии приемки:
- При обнаружении CI/неинтерактивного режима озвучка не запускается.
- Текстовый вывод сохраняется без изменений.
- Поведение не требует ручных действий пользователя.
Приоритет: High

### Story 2.5 — Интеграция chatterbox TTS
Краткое описание: использовать chatterbox как основной TTS-движок с полным функционалом.
Ценность для пользователя: высокое качество озвучки, голос-клон, теги, выбор моделей.
Критерии приемки:
- Поддерживается Turbo и Multilingual режимы через конфиг или флаг.
- Поддерживается voice prompt (референсный аудиофайл).
- Поддерживаются парлингвистические теги в тексте.
- При отсутствии GPU есть CPU fallback с предупреждением.
- Ошибки TTS не блокируют текстовый вывод.
Приоритет: High

## Эпик 3: Сохранение и обмен результатами

### Story 3.1 — Экспорт результата в файл
Краткое описание: экспорт итога в txt/md.
Ценность для пользователя: возможность поделиться и вернуться к результату.
Критерии приемки:
- После синтеза создается файл в формате txt или md.
- CLI выводит путь к сохраненному файлу.
- Экспорт не влияет на отображение результата в терминале.
Приоритет: Medium

### Story 3.2 — Экспорт с выбранными секциями
Краткое описание: экспорт только нужных секций.
Ценность для пользователя: контроль содержимого файла.
Критерии приемки:
- При указании флагов экспортируются только выбранные секции.
- Порядок в файле сохраняется как «Итог -> Расхождения -> Цитаты».
- Форматирование сохраняет читаемую структуру секций.
Приоритет: Low

## Разбиение по спринтам

### Спринт 1
Цель спринта: базовый синтез, надежность вывода, базовое управление TTS.
Истории:
- Story 1.1 — Синтез итогов и расхождений (приоритет: High, оценка: 5 SP)
- Story 1.2 — Прозрачные цитаты-источники (приоритет: High, оценка: 5 SP)
- Story 2.1 — Включение и выключение TTS (приоритет: High, оценка: 3 SP)
- Story 2.3 — Озвучка итогов с fallback (приоритет: High, оценка: 3 SP)
- Story 2.4 — Авто-отключение в CI/неинтерактиве (приоритет: High, оценка: 2 SP)

### Спринт 2
Цель спринта: UX-детали, управление детализацией и экспорт.
Истории:
- Story 1.3 — Управление уровнем детализации вывода (приоритет: Medium, оценка: 3 SP)
- Story 1.4 — Статусы обработки (приоритет: Medium, оценка: 2 SP)
- Story 2.2 — Выбор голоса и скорости (приоритет: Medium, оценка: 3 SP)
- Story 3.1 — Экспорт результата в файл (приоритет: Medium, оценка: 3 SP)
- Story 3.2 — Экспорт с выбранными секциями (приоритет: Low, оценка: 2 SP)

## Оценки трудоемкости

Метод: Story Points (SP)
Принципы оценки:
- Оценка включает реализацию, тесты и краткую документацию.
- Внешние зависимости и неизвестные интеграции не включены в оценку.

Оценки по историям:
- Story 1.1 — 5 SP — синтез нескольких ответов и формирование структуры вывода.
- Story 1.2 — 5 SP — привязка цитат к расхождениям и вывод источников.
- Story 1.3 — 3 SP — переключение режимов и фильтрация секций.
- Story 1.4 — 2 SP — простые статусы прогресса без блокировки вывода.
- Story 2.1 — 3 SP — конфиг/флаги и управление состоянием TTS.
- Story 2.2 — 3 SP — параметры голоса/скорости и безопасные дефолты.
- Story 2.3 — 3 SP — обработка ошибок и неблокирующий fallback.
- Story 2.4 — 2 SP — детект CI/неинтерактива и отключение TTS.
- Story 3.1 — 3 SP — экспорт в файл с выводом пути.
- Story 3.2 — 2 SP — экспорт выбранных секций.
