# Правила синтеза итогов и расхождений (Story 1.1)

Дата: 2026-01-07

## Цель
Сделать итог понятным, проверяемым и устойчивым к разным ответам агентов.

## Входной контракт (минимум)
- `agent_id`: строка, обязательна
- `content`: строка, обязательна
- `citations`: список объектов `{source, quote}` (опционально)

## Итог (Summary)
1) Если ответы совпадают по смыслу (после нормализации), итог = краткая консолидированная формулировка.
2) Если есть разные подходы, итог должен:
   - перечислить 1–2 основных направления,
   - указать, какое выбрать при стандартных условиях,
   - отметить условия, при которых предпочтителен другой вариант.
3) Итог не должен превышать 3–5 предложений.

## Расхождения (Divergences)
Расхождение фиксируется, если:
- разные решения/подходы (например, «использовать X» vs «использовать Y»),
- разные параметры/настройки (разные значения, режимы, флаги),
- разные допущения/ограничения (GPU vs CPU, наличие токена, версии).

Формат пункта расхождения:
- `<agent_id>: <ключевая формулировка отличия>`

## Нормализация (для сравнения)
- привести к нижнему регистру,
- удалить лишние пробелы/переносы,
- сравнивать по нормализованной строке.

## Цитаты
- Показывать только при `--include-citations`.
- Привязывать цитаты к соответствующим расхождениям, если возможно.

## Пограничные случаи
- Один ответ: расхождения отсутствуют.
- Пустой ввод или нет валидных ответов: показать «Нет данных для синтеза».

## Критерии приемки
- Итог не зависит только от первого ответа при наличии расхождений.
- Расхождения перечисляются детерминированно и кратко.
- Вывод остаётся стабильным при одинаковых входах.
